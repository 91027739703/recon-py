function handleQuoteMessage(e){var t=$.trim(e),n=t.match(/^&gt;\s+(.*)$/);if(n){var i=$("<div/>").addClass("quote").html(n[1]);return $("<p/>").append(i).html()}if(/^<div[^>]*?>&gt;/i.test(t)){var o=$(t);if(o.hasClass("partial")||o.hasClass("full")){o[0].normalize();for(var a=o[0].childNodes,r=!0,s=!1,c=!1,l=0;l<a.length;l++){var u=a[l];if(3===u.nodeType&&/\S/.test(u.nodeValue)){var d=/^\s*>\s/.test(u.nodeValue);r||(s|=d,c|=!d),r=!1,d&&(u.nodeValue=u.nodeValue.replace(/^\s*>\s+/,""))}}if(!c||!s)return o.addClass("quote")[0].outerHTML}}return e}function popUp(e,t,n,i){i||$(".popup").remove();var o={},a=e-$(window).scrollLeft(),r=t-$(window).scrollTop();a<$(window).width()/2?o.left=a:o.right=$(window).width()-a,r<$(window).height()/2?o.top=r:o.bottom=$(window).height()-r;var s=div("popup").css(o).hide(),c=$("<div class='btn-close'>X</div>");return c.click(function(){$(this).closest(".popup").fadeOut(200,function(){$(this).remove()})}).prependTo(s),s.appendTo(n||$("body")).fadeIn(200),s.close=function(){s.fadeOut(200,function(){s.remove()})},s}function popupDismisser(){$(document).click(function(e){0==$(e.target).closest(".popup").length&&0==$(e.target).closest(".ac_results").length&&$(".popup:not(.mini-help)").fadeOut(200,function(){$(this).remove()})}),$(document).bind("keydown",function(e){27==e.which&&$(".popup:not(.mini-help)").fadeOut(200,function(){$(this).remove()})})}function fkey(e){return e||(e={}),e.fkey||(e.fkey=$("input[name='fkey']").attr("value")),e}function repNumber(e){if(1e4>e)return e;if(1e5>e){var t=Math.floor(Math.round(e/100)/10),n=Math.round((e-1e3*t)/100);return t+(n>0?"."+n:"")+"k"}return Math.round(e/1e3)+"k"}function htmlEncode(e){return document.createElement("div").appendChild(document.createTextNode(e)).parentNode.innerHTML}function selectStackSite(e,t,n,i,o,a){var r=popUp(e.pageX,e.pageY,o,a).css({"width":"auto","position":"absolute"}),s=$("<p/>").text("Loading available sites...");r.append(s);var c=n?{}:{"sort":"site"},l=function(e){if(e&&e.length){s.text("select a site:");var t=$('<input type="text"/>').appendTo(r);t.autocomplete(e,{"minChars":0,"width":310,"matchContains":"word","autoFill":!1,"formatItem":function(e){return'<img class="icon-16" src="'+e.SiteIcon+'"/> '+htmlEncode(e.SiteCaption)},"formatMatch":function(e){return htmlEncode(e.SiteCaption+" "+e.Host)},"formatResult":function(e){return e.Host}}).result(function(e,t){t&&(r.close(),i(t.Host,t.SiteCaption,t.SiteIcon))}).focus()}else s.text("(no sites found)")};t?$.post("/users/sites/"+t,c,l):$.get("/rooms/sites",l)}function PERMALINK(e){return"/transcript/message/"+e+"#"+e}function div(e){return $("<div/>").addClass(e)}function span(e){return $("<span/>").addClass(e)}function confirmFlag(e){return confirm("Do you want to flag this message as spam, inappropriate, or offensive?"+(e?" Since you're a moderator, this flag is binding.":""))}function messageActionById(e,t,n,i,o){n||(n={}),$.ajax({"type":"POST","url":"/messages/"+e+"/"+t,"data":fkey(n),"success":function(e){i?i(e):"ok"!=e&&o&&o(e||GENERIC_ERROR)},"dataType":"json","error":function(e,t){var n="error"==t?409==e.status?e.responseText:GENERIC_ERROR:t;i?i(n):o&&o(n)}})}function Notifier(e,t){function n(t,n){"string"!=typeof t&&(t=t.text()),(void 0==n||n)&&e.broadcast({"command":"dismiss notification","notification":t});var i=$(".notification").not(".closing");i.find("p.notification-message").not(".dismissed").each(function(){$(this).text()==t&&$(this).addClass("dismissed").slideUp(function(){$(this).remove()})}),i.find("p.notification-message").not(".dismissed").length||i.slideUp(function(){$(this).remove()})}function i(t,i){t&&t.message&&(t=t.message);var o=$(".notification").not(".closing"),a=!0;if(0==o.length){a=!1,o=div("notification").hide().appendTo("body");var r=$("<div/>").addClass("notify-close-info").text(s?"Ok":c?"remove notification":"click here to remove the notification bar").appendTo(o).click(function(){if(s){o.find("p.notification-message:last").remove();var t=o.find("p.notification-message").length;0===t?o.remove():$(this).text("Ok"+(t>1?" ("+t+")":""))}else o.find("p.notification-message").not(".dismissed").each(function(){e.broadcast({"command":"dismiss notification","notification":$(this).text()})}),o.addClass("closing").slideUp(function(){$(this).remove()})});s&&(r.addClass("button"),o.css("top",$(window).scrollTop()+$(window).height()/20))}else if(lastmsg=o.find("p.notification-message:"+(s?"first":"last")),lastmsg.html()==$("<span />").html(t).html())return lastmsg;var l=$("<p/>").addClass("notification-message").html(t).hide();if(s?l.prependTo(o):l.insertBefore(o.find(".notify-close-info")),i&&i.length>0&&l.addClass(i),a){if(l.slideDown(),s){var u=o.find("p.notification-message").length;o.find(".notify-close-info").text("Ok"+(u>1?" ("+u+")":""))}}else l.show(),o.slideDown();return l.find("a").click(function(){n($(this).closest(".notification-message"))}),l}function o(e){e.close(),u=Generator(u).filter(function(t){return t!==e}).toArray()}function a(){Generator(u).forEach(function(e){e.close()}),u=[]}function r(e,t){u.push(e),e.onclick=function(){window.focus()},t&&setTimeout(function(){o(e)},t)}var s=t&&!CHAT.NEW_MOBILE,c=t&&CHAT.NEW_MOBILE;e||(e={"broadcast":function(){}});var l=null;if(window.Notification&&"permission"in Notification){var u=[];l=function(e){if(e&&e.text){if("granted"!==window.Notification.permission)return!1;e.icon&&e.icon.length||(e.icon=$('link[rel="apple-touch-icon"]').attr("href")),e.icon&&e.icon.length||(e.icon=$('link[rel="shortcut icon"]').attr("href"));var t=new Notification(e.title,{"body":e.text,"icon":e.icon});return t?(r(t,e.timeout),!0):!1}return"granted"===window.Notification.permission?(e&&e.callback&&e.callback(),!0):e&&e.callback?(window.Notification.requestPermission(e.callback),!1):!1},l.removeAll=a}return{"notify":i,"dismissSingleNotification":n,"desktop":l}}function initSearchBox(){var e=$("#searchbox"),t="search";e.focus(function(){$(this).val()==t&&$(this).val(""),e.removeClass("watermark")}),e.blur(function(){""==$(this).val()&&($(this).val(t),e.addClass("watermark"))});var n=e.val();(""===n||n===t)&&(e.val(t),e.addClass("watermark")),e.closest("form").on("submit",function(){setTimeout(function(){e.val(t).addClass("watermark").blur()},0)})}function BindFlagListPopup(e,t,n,i,o){function a(e){return function(){e.find(".ajax-loader").remove(),e.closest("li").find("button:contains('delete')").replaceWith("<span>message deleted</span>")}}function r(e,t){return function(){confirm("Delete this message?")&&($("<img class='ajax-loader' src='"+IMAGE("progress-dots.gif")+"' />").appendTo(t),messageActionById(e,"delete",null,a(t),i))}}function s(e,i){i.find("img.ajax-loader").remove(),i.find("h3").text(-1!=t.indexOf("moderator")?"Moderator flags":"New spam/offensive flags").append(" <a href='"+n+"'>show all</a>");var a=$("<ul />").appendTo(i);if(!e.messages||!e.messages.length)return $("<div>There are no flags to display.</div>").appendTo(i),o&&o(),void 0;for(var s=0;s<e.messages.length;s++){var c=e.messages[s],l=!c.is_mod,u=l?"as spam/offensive":"for moderator attention",d=$("<li class='flagged-message' />").data("message_id",c.message_id).appendTo(a);$("<h4>This message was flagged "+u+" by "+c.flag_count+" user"+(c.flag_count>1?"s":"")+":</h4>").appendTo(d),$("<div class='content'/>").appendTo(d).html(c.content);var f;if(f=c.deleted?" message is deleted &ndash; <a class='room-name' href='/messages/"+c.message_id+"/history'>history</a>":"<a class='room-name' href='"+PERMALINK(c.message_id)+"'>see in context</a>",$("<div style='text-align:right'> posted by <a href='/users/"+c.user_id+"'></a> "+(c.time?ToRelativeTimeMini(c.time):"")+" &ndash; "+f+"</div>").appendTo(d).find("a:first").text(c.username).end().find("a.room-name").removeClass("room-name").text(c.room_name),l){var h=$("<div />");if(h.append("<button class='button reflag' title='agree that this message is spam or offensive'>valid</button> "),h.append("<button class='button counterflag' title='this message is neither spam nor offensive'>invalid</button> "),h.append("<button class='button mehflag' title='no strong opinion'>not sure</button> "),h.appendTo(d),c.modflags&&c.modflags.length)for(var p=$("<p>(&#9830; only) flagged by</p>").appendTo(d),m=0;m<c.modflags.length;m++){var g=c.modflags[m];p.append(0==m?": ":", ").append($("<a href='/users/"+g.user_id+"'></a>").text(g.username))}}else{var v=$("<ul />").appendTo(d);c.deleted||$("<button class='button' title='delete this message'>delete</button>").click(r(c.message_id,v)).appendTo(d.find("div:last").append("<span> &ndash; </span>"));for(var m=0;m<c.modflags.length;m++){var g=c.modflags[m],y=$("<span> &ndash; <a href='/users/"+g.user_id+"'></a></span>");y.find("a").text(g.username);var w=$('<span title="dismiss this moderator flag" class="quick-unmod btn-delete"> </span>'),b=$("<span class='mod-text' />");g.html?b.html(g.html):b.text(g.text);var C;C=g.user_id>0?$("<span><input type='checkbox' name='noise'/> this flag is noise</span>").find("input").css({"marginLeft":10,"verticalAlign":"bottom"}).end().attr("title","If this box is checked, dismissing the flag will show a notification to the flagger that moderator flags are reserved for serious issues."):$([]),v.append($("<li />").append(w,b,y,C).data("flag_id",g.flag_id))}}}}$(e).click(function(e){e.stopPropagation(),e.preventDefault();var n=popUp(e.pageX,e.pageY).css({"width":"auto","maxWidth":600,"minWidth":300}).addClass("flags-popup").append("<h3>Loading flags <img class='ajax-loader' src='"+IMAGE("progress-dots.gif")+"' /></h3>");$.getJSON(t,function(e){s(e,n)})})}function roomAccessControl(e,t){function n(e){$("<a/>").addClass("dropdown-button button change-user-access").attr("href","#").css({"position":"absolute","bottom":2,"left":2}).appendTo(e).append("<div class='img' />")}function i(t){var n=$("<form/>").attr("action","/rooms/setuseraccess/"+e).attr("method","post").append($("<input/>").attr("type","hidden").attr("name","fkey").val(a));return void 0!=t&&$("<input/>").attr("type","hidden").attr("name","aclUserId").val(t).appendTo(n),n}function o(e){var t=$("#add-user-search-result");t.empty().append($("<img/>").attr("src",IMAGE("ajax-loader.gif"))),$("#add-user-search-result").load("/users",{"filter":e.toLowerCase(),"mini":!0,"nofade":!0},function(e,t){"success"==t&&(accessType=$("#add-user-search-result").closest(".access-section").attr("id").replace("access-section-",""),$("#add-user-search-result .usercard").each(function(){n(this)}))})}var a=$("input[name='fkey']").attr("value"),r={"remove":"no special access","read-only":"read access","read-write":"write access","moderation":"moderator","owner":"owner"},s={"read-only":"grant read access","read-write":"grant write access","moderation":"make moderator","owner":"make owner"},c=!1;$(document).on("click","*",function(e){c||(0==$(e.target).closest(".popup").length&&$(".popup").remove(),c=!0,setTimeout(function(){c=!1},0))}),$(".usercard").each(function(){n(this)}),$(document).on("click",".change-user-access",function(t){t.preventDefault();var n=$(this).closest(".usercard").attr("id").replace(/(?:access-)?user-/,""),o=$(this).closest(".access-section").attr("id").replace("access-section-",""),s=$(this).closest(".usercard"),c=s.position();c.left+=20,c.top+=38,c.position="absolute";var l=$("<div/>").addClass("popup").css(c).hide().insertBefore($(this).closest(".usercard"));if($("<h3/>").text("Access for "+$(this).closest(".usercard").find(".username").text()).appendTo(l),window.userKeys&&n in userKeys){var u=userKeys[n],d=$("<div/>").appendTo(l);u?(d.text("Key: "+u),l.css({"width":"auto"})):d.text("Key: none"),$("<form/>").attr("action","/rooms/makeFeedKey").attr("method","post").append($("<input/>").attr("type","hidden").attr("name","fkey").val(a)).append($("<input/>").attr("type","hidden").attr("name","userId").val(n)).append($("<input/>").attr("type","hidden").attr("name","roomId").val(e)).append($("<input/>").attr("type","submit").val("create new key").addClass("button")).appendTo(d)}var f=i(n).appendTo(l),h=$(this).closest("#add-user-search-result").length;for(u in r){var p=u==o;if(p||"moderation"!=u){var m=u+"-radio";$('<input name="userAccess" type="radio"/>').attr("id",m).val(u).prop("checked",p).appendTo(f),$("<label/>").attr("for",m).text(" "+r[u]).css("font-weight",p&&!h?"bold":"normal").appendTo(f),$("<br/>").appendTo(f)}}$('<span><input class="button" type="submit" value="change"/> </span>').appendTo(f),$('<span class="button">cancel</span>').click(function(){l.remove()}).appendTo(f),l.slideDown(200)}),$(document).on("click",".add-user-button",function(){accessType=$(this).closest(".access-section").attr("id").replace("access-section-","");var e=$("<div/>").addClass("popup").css({"width":735,"position":"absolute","right":100,"top":20,"overflow":"visible"}).appendTo($(this).closest(".access-section"));$("<h3/>").text("Add a new user to the "+r[accessType]+" list").appendTo(e);var n=i().appendTo(e);$('<input type="hidden" name="userAccess" />').val(accessType).appendTo(n),t||$("<p>Please note, <strong>you can only add users in the following cases</strong>:</p><ul><li>They have already visited <em>"+location.hostname+"</em>.</li><li>They have sufficient reputation to talk in chat (&gt;20 reputation).</li></ul>").appendTo(n);{var a=$('<p>If you have it, enter the <strong>user id</strong> or the user\'s <strong>profile URL</strong> here: <input type="text" name="aclUserId"/> <input class="button" type="submit" value="'+s[accessType]+'"/></p>').appendTo(n),c=a.find(".button"),l=$("<p>Otherwise"+(t?", if they have already visited "+location.hostname+" before, you can":"")+" search for their <b>user name</b>: </p>").appendTo(e),u=$("<input/>").attr("type","text").appendTo(l).bind("change keyup click",function(){$(this).val()?c.css("visibility","hidden"):c.css("visibility","visible")});$("<div/>").attr("id","add-user-search-result").appendTo(e)}$('<div class="clear-both"/>').appendTo(e),$('<span class="button">cancel</span>').click(function(){e.remove()}).appendTo(e),u.keyup(function(e){13==e.which&&o(u.val())}).typeWatch({"callback":o,"wait":500,"captureLength":2})})}function SymmetricList(e,t){$(".subtabs a",e).click(function(n){n.preventDefault();var i=$(this),o=$("<img/>").attr("src",IMAGE("ajax-loader.gif")).css("float","left").prependTo(e.find(".subtabs"));t.load(i.attr("href"),function(){initCycling(),o.remove(),e.find(".subtabs a").removeClass("youarehere"),i.addClass("youarehere")})})}function InitUserIndex(e,t,n,i){InitIndexPage(e,t,n,i,"filter users","/users","#userlist",".username, .user-message-info")}function InitRoomIndex(e,t,n,i,o,a){function r(){var e=$(this),t=e.closest(".roomcard, .roomcard-xxl").attr("id").replace("room-","");e.toggleClass("favorite-room"),$.post("/rooms/favorite",fkey({"roomId":t}),function(t){t&&(t.isFavorite?e.addClass("favorite-room"):e.removeClass("favorite-room"))})}function s(){"invited"==e&&$("#roomlist .roomcard").append($("<span/>").addClass("btn-delete").addClass("cancel-invite").attr("title","ignore this invite"))}function c(e){e.animate({"opacity":0,"width":"0px","height":"0px"},800,function(){e.remove()})}if(initCycling(),cycle(),doEllipsis(),arguments.length>0){var l={};o&&(l.nohide=!0),a&&a.length&&(l.host=a),InitIndexPage(e,t,n,i,"filter rooms","/rooms","#roomlist",".room-name, .room-description, .room-header .tag",s,l),$(".join-link").click(function(){return $.post($(this).attr("href"),fkey({"quiet":!0}),function(e){window.location=e}),!1})}s(),$(document).on("click",".favorite-room-vote",r),$(document).on("click",".cancel-invite",function(){var e=$(this).closest(".roomcard");$.post("/users/cancel-invite",fkey({"roomid":e.attr("id").replace("room-","")}),function(){c(e)})}),$(document).on("click","#site-select",function(e){return selectStackSite(e,0,!1,function(e){location.href=$("#site-select").attr("href")+"&host="+encodeURIComponent(e)}),!1})}function initCycling(){$(".cycle").each(function(){var e=$(this),t=e.children();if(e.removeClass("cycle"),!(t.length<2)){e.addClass("cycling");var n=-1;t.each(function(){var e=$(this),t=-1==n;n=Math.max(n,e.height()),e.css({"position":"absolute","opacity":t?1:0,"zIndex":t?1:0})}),e.css({"height":n})}})}function cycle(){setInterval(function(){var e;try{e=$(".cycling:hover")}catch(t){e=$([])}$(".cycling").each(function(){var t,n,i=$(this);if(!(e.filter(i).length>0)){var o=i.children();o.each(function(){var e=$(this);e.css("opacity")>.5?t=e:t&&!n&&(n=e)}),n||(n=o.eq(0)),n.height()>i.height()&&i.animate({"height":n.height()},1e3),t.animate({"opacity":0},1e3).css("z-index",0),n.animate({"opacity":1},1e3).css("z-index",1)}})},5e3)}function InitIndexPage(e,t,n,i,o,a,r,s,c,l){function u(){var e=$("#search").val();return e==o?"":e}var d=$("#search").val();""==d?$("#search").val(o).addClass("watermark"):$(s).highlight(d).removeClass("watermark");var f=function(){var o=u(),f={"tab":e,"sort":t,"filter":o,"pageSize":n,"page":o==d?i:void 0};if(l)for(var h in l)f[h]=l[h];$(r).load(a,f,function(e,t){if("success"==t){initCycling(),doEllipsis();var n=$(s);o&&o.length>0&&n.length>0&&n.highlight(o),c&&c()}})};$("#search").keyup(function(e){13==e.which&&f()}).typeWatch({"callback":f,"wait":500,"captureLength":2}),$("#search").focus(function(){$(this).val()==o&&$(this).val("").removeClass("watermark")}).blur(function(){""==$(this).val()&&$(this).val(o).addClass("watermark")}),setInterval(function(){f()},6e4)}function initScheduleInfo(e,t,n){function i(e){return $(e).closest(".meeting").attr("id").replace("meeting-","")}function o(e){var t=e.find(".attendees .usercard").length;e.find("span.attendee-count").text(0==t?"No users have":1==t?"One user has":t+" users have")}$(function(){var a=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"];$(".local-time-placeholder").each(function(){var e,t,n,i=$(this).removeClass("local-time-placeholder"),o=parseInt(i.attr("data-time"));isFinite(o)&&(e=new Date(1e3*o),n=e.getMinutes(),t=e.getHours()+":"+(10>n?"0":"")+n,i.text(" (in your timezone, that's "+t+" on "+a[e.getDay()]+")"))}),t&&($("#firstTime").timePicker({"step":15}),$(".meeting .btn-delete").click(function(){var t=$(this).closest(".meeting"),n=t.find(".icon");confirm("This will delete this item from the schedule; are you sure?\n\nIf there is a corresponding event in the parent site, it will not be removed automatically.")&&$.post("/rooms/schedule/delete/"+e,fkey({"meetingId":i(this)}),function(){n.length&&0==t.next(".meeting").find(".calendar").length&&n.prependTo(t.next(".meeting")),t.slideUp(function(){t.remove()})})})),$(".sched-reg").click(function(){var t=$(this),n=t.closest(".meeting"),a=n.find(".sched-unreg");n.find(".ajax-loader").show(),$.post("/rooms/schedule/reg/"+e,fkey({"meetingId":i(this)}),function(e){var i=n.find(".attendees");if(0==i.length){var r=n.find(".meeting-info");i=$('<div class="attendees" />').appendTo(r),$('<div class="clear-both" />').appendTo(r)}$(e).hide().appendTo(i).slideDown(),n.find(".ajax-loader").hide(),t.hide(),a.show(),o(n)})}),$(".sched-unreg").click(function(){var t=$(this),a=t.closest(".meeting"),r=a.find(".sched-reg"),s=a.attr("id")+"-user-"+n;a.find(".ajax-loader").show(),$.post("/rooms/schedule/unreg/"+e,fkey({"meetingId":i(this)}),function(){$("#"+s).slideUp(function(){$(this).remove(),o(a)}),a.find(".ajax-loader").hide(),t.hide(),r.show()})})})}function initSearchScreen(e){$("#user").autocomplete("/users/search",{"formatItem":function(e){return $.parseJSON(String(e)).dn},"formatResult":function(e){return $.parseJSON(String(e)).id},"max":20}),$("#room").autocomplete("/rooms/search",{"formatItem":function(e){return $.parseJSON(String(e)).name},"formatResult":function(e){return $.parseJSON(String(e)).id}}),$(".searchroom .btn-delete").click(function(){$(".searchroom").remove(),$("#room").val("").removeClass("hidden")}),$(".searchuser .btn-delete").click(function(){$(".searchuser").remove(),$("#user").val("").removeClass("hidden")}),e&&$("#q").focus()}function doEllipsis(){var e="div.roomcard > .room-header > .room-description, div.usercard-mini > .user-header > .user-message-info";$(e).each(function(){Ellipsis($(this))})}function Ellipsis(e){var t=e.height(),n=e.text(),i=$("<div/>").text(n);if(e.empty().append(i),i.height()<=t)return i.remove(),e.text(n),void 0;for(var o,a,r=0,s=n.length;s>r;)o=Math.round((r+s)/2),a=n.substr(0,o),i.text(a+"&hellip;"),i.height()<=t?r=o:s=o-1;a=n.substr(0,r),i.remove(),e.text(a+"…")}function initBasicPage(e,t,n,i){if(initSearchBox(),notify=Notifier().notify,n&&notify(n),i&&!$.cookie("x")){var o=notify("Welcome to "+e+" chat! You'll need "+t+" reputation to talk here. This site is moderated by the community, so please be respectful of your fellow "+e+' users. And while you\'re at it, check out the <a href="/faq">FAQ</a>!');o.find("a").add(".notify-close-info").click(function(){$.cookie("x","0",{"expires":90,"path":"/"})})}return{"notify":notify}}window.CHAT={"RoomUsers":{}},/^#nonewmob;/.test(location.hash)&&(location.hash=location.hash.substr(10),location.hash.length<=1&&window.history&&window.history.replaceState&&history.replaceState(null,null,location.href.replace(/#$/,""))),function(e){"use strict";"function"==typeof define&&define.amd?define(["jquery"],e):"undefined"!=typeof module&&module.exports?module.exports=e(require("jquery")):e(jQuery)}(function(e){"use strict";function t(t){return!t.nodeName||-1!==e.inArray(t.nodeName.toLowerCase(),["iframe","#document","html","body"])}function n(t){return e.isFunction(t)||e.isPlainObject(t)?t:{"top":t,"left":t}}var i=e.scrollTo=function(t,n,i){return e(window).scrollTo(t,n,i)};return i.defaults={"axis":"xy","duration":0,"limit":!0},e.fn.scrollTo=function(o,a,r){"object"==typeof a&&(r=a,a=0),"function"==typeof r&&(r={"onAfter":r}),"max"===o&&(o=9e9),r=e.extend({},i.defaults,r),a=a||r.duration;var s=r.queue&&1<r.axis.length;return s&&(a/=2),r.offset=n(r.offset),r.over=n(r.over),this.each(function(){function c(t){var n=e.extend({},r,{"queue":!0,"duration":a,"complete":t&&function(){t.call(d,h,r)}});f.animate(p,n)}if(null!==o){var l,u=t(this),d=u?this.contentWindow||window:this,f=e(d),h=o,p={};switch(typeof h){case"number":case"string":if(/^([+-]=?)?\d+(\.\d+)?(px|%)?$/.test(h)){h=n(h);break}h=u?e(h):e(h,d);case"object":if(0===h.length)return;(h.is||h.style)&&(l=(h=e(h)).offset())}var m=e.isFunction(r.offset)&&r.offset(d,h)||r.offset;e.each(r.axis.split(""),function(e,t){var n="x"===t?"Left":"Top",o=n.toLowerCase(),a="scroll"+n,g=f[a](),v=i.max(d,t);l?(p[a]=l[o]+(u?0:g-f.offset()[o]),r.margin&&(p[a]-=parseInt(h.css("margin"+n),10)||0,p[a]-=parseInt(h.css("border"+n+"Width"),10)||0),p[a]+=m[o]||0,r.over[o]&&(p[a]+=h["x"===t?"width":"height"]()*r.over[o])):(n=h[o],p[a]=n.slice&&"%"===n.slice(-1)?parseFloat(n)/100*v:n),r.limit&&/^\d+$/.test(p[a])&&(p[a]=0>=p[a]?0:Math.min(p[a],v)),!e&&1<r.axis.length&&(g===p[a]?p={}:s&&(c(r.onAfterFirst),p={}))}),c(r.onAfter)}})},i.max=function(n,i){var o="x"===i?"Width":"Height",a="scroll"+o;if(!t(n))return n[a]-e(n)[o.toLowerCase()]();var o="client"+o,r=n.ownerDocument||n.document,s=r.documentElement,r=r.body;return Math.max(s[a],r[a])-Math.min(s[o],r[o])},e.Tween.propHooks.scrollLeft=e.Tween.propHooks.scrollTop={"get":function(t){return e(t.elem)[t.prop]()},"set":function(t){var n=this.get(t);if(t.options.interrupt&&t._last&&t._last!==n)return e(t.elem).stop();var i=Math.round(t.now);n!==i&&(e(t.elem)[t.prop](i),t._last=this.get(t))}},i}),jQuery.cookie=function(e,t,n){if("undefined"==typeof t){var i=null;if(document.cookie&&""!=document.cookie)for(var o=document.cookie.split(";"),a=0;a<o.length;a++){var r=jQuery.trim(o[a]);if(r.substring(0,e.length+1)==e+"="){i=decodeURIComponent(r.substring(e.length+1));break}}return i}n=n||{},null===t&&(t="",n.expires=-1);var s="";if(n.expires&&("number"==typeof n.expires||n.expires.toUTCString)){var c;"number"==typeof n.expires?(c=new Date,c.setTime(c.getTime()+24*n.expires*60*60*1e3)):c=n.expires,s="; expires="+c.toUTCString()}var l=n.path?"; path="+n.path:"",u=n.domain?"; domain="+n.domain:"",d=n.secure?"; secure":"";document.cookie=[e,"=",encodeURIComponent(t),s,l,u,d].join("")},function(e){var t=e.preload=function(n,i){function o(o){c.element=this,c.found="load"==o.type,c.image=this.src,c.index=this.index;var s=c.original=n[this.index];c[c.found?"loaded":"failed"]++,c.done++,i.enforceCache&&t.cache.push(e("<img/>").attr("src",c.image)[0]),i.placeholder&&s.src&&(s.src=c.found?c.image:i.notFound||s.src),i.onComplete&&i.onComplete(c),c.done<c.total?a(0,this):(l&&l.unbind&&l.unbind("load").unbind("error").unbind("abort"),l=null,r())}function a(o,r,l){return r.attachEvent&&c.next&&c.next%t.gap==0&&!l?(setTimeout(function(){a(o,r,!0)},0),!1):c.next==c.total?!1:(r.index=c.next,r.src=s[c.next++],i.onRequest&&(c.index=r.index,c.element=r,c.image=r.src,c.original=n[c.next-1],i.onRequest(c)),r.complete&&e(r).trigger("load"),void 0)}function r(){i.onFinish&&i.onFinish(c)}n.split&&(n=e(n)),i=e.extend({},t.defaults,i);var s=e.map(n,function(e){if(e){if(e.split)return i.base+e+i.ext;var t=e.src||e.href;return"string"==typeof i.placeholder&&e.src&&(e.src=i.placeholder),t&&i.find&&(t=t.replace(i.find,i.replace)),t||null}}),c={"loaded":0,"failed":0,"next":0,"done":0,"total":s.length};if(!c.total)return r();var l=e(Array(i.threshold+1).join("<img/>")).load(o).error(o).bind("abort",o).each(a)};t.gap=14,t.cache=[],t.defaults={"threshold":2,"base":"","ext":"","replace":""},e.fn.preload=function(e){return t(this,e),this},function(){var t=(e.fn.preload,e.preload);e.fn.preload=function(){try{return t.apply(this,arguments)}catch(e){return this}},e.preload=function(){try{t.apply(this,arguments)}catch(e){}}}()}(jQuery),function(e){e.fn.typeWatch=function(t){function n(t,n){var i=e(t.el).val();(i.length>o.captureLength&&i.toUpperCase()!=t.text||n&&i.length>o.captureLength)&&(t.text=i.toUpperCase(),t.cb(i))}function i(t){if("TEXT"==t.type.toUpperCase()||"TEXTAREA"==t.nodeName.toUpperCase()){var i={"timer":null,"text":e(t).val().toUpperCase(),"cb":o.callback,"el":t,"wait":o.wait};o.highlight&&e(t).focus(function(){this.select()});var a=function(e){var t=i.wait,o=!1;13==e.keyCode&&"TEXT"==this.type.toUpperCase()&&(t=1,o=!0);var a=function(){n(i,o)};clearTimeout(i.timer),i.timer=setTimeout(a,t)};e(t).keydown(a)}}var o=e.extend({"wait":750,"callback":function(){},"highlight":!0,"captureLength":2},t);return this.each(function(){i(this)})}}(jQuery),function(e){var t;t=Array.prototype.indexOf?function(e,t){return e.indexOf(t)}:function(e,t){for(var n=e.length,i=0;n>i;i++)if(i in e&&e[i]===t)return i;return-1};var n={},i=function(e){return this instanceof i?(this.forEach="function"==typeof e?s(e):e.constructor===Array?c(e):l(e),void 0):new i(e)},o=function(e){return e instanceof i?e:new i(e)},a=function(){throw n},r=function(e){this.message=e,this.name="IterationError"};r.prototype=Error.prototype;var s=function(e){return function(t,i){var s=!1,c=0,l=function(e){if(s)throw new r("yield after end of iteration");var n=t.call(i,e,c,a);return c++,n},u=function(e){o(e).forEach(function(e){l(e)})};try{e(l,u,a)}catch(d){if(d!==n)throw d}finally{s=!0}}},c=function(e){return s(function(t){for(var n=e.length,i=0;n>i;i++)i in e&&t(e[i])})},l=function(e){return s(function(t){for(var n in e)e.hasOwnProperty(n)&&t([n,e[n]])})},u=function(e){return"string"==typeof e?function(t){return t[e]}:e};i.prototype={"toArray":function(){var e=[];return this.forEach(function(t){e.push(t)}),e},"filter":function(e,t){var n=this;return e=u(e),new i(function(i){n.forEach(function(n){e.call(t,n)&&i(n)})})},"take":function(e){var t=this;return new i(function(n){t.forEach(function(t,i,o){i>=e&&o(),n(t)})})},"skip":function(e){var t=this;return new i(function(n){t.forEach(function(t,i){i>=e&&n(t)})})},"map":function(e,t){var n=this;return e=u(e),new i(function(i){n.forEach(function(n){i(e.call(t,n))})})},"zipWithArray":function(e,t){"undefined"==typeof t&&(t=function(e,t){return[e,t]});var n=this;return new i(function(i){var o=e.length,a=0;n.forEach(function(n,r,s){for(;!(r+a in e)&&o>r+a;)a++;r+a>=o&&s(),i(t(n,e[r+a]))})})},"reduce":function(e,t){var n,i;return arguments.length<2?n=!0:(n=!1,i=t),this.forEach(function(t){n?(i=t,n=!1):i=e(i,t)}),i},"and":function(e){var t=this;return new i(function(n,i){i(t),i(e)})},"takeWhile":function(e){var t=this;return e=u(e),new i(function(n){t.forEach(function(t,i,o){e(t)?n(t):o()})})},"skipWhile":function(e){var t=this;return e=u(e),new i(function(n){var i=!0;t.forEach(function(t){i=i&&e(t),i||n(t)})})},"all":function(e){var t=!0;return e=u(e),this.forEach(function(n,i,o){(e?e(n):n)||(t=!1,o())}),t},"any":function(e){var t=!1;return e=u(e),this.forEach(function(n,i,o){(e?e(n):n)&&(t=!0,o())}),t},"first":function(){var e;return this.forEach(function(t,n,i){e=t,i()}),e},"groupBy":function(e){var n=this;return e=u(e),new i(function(o,a){var r=[],s=[];n.forEach(function(n){var i=e(n),o=t(r,i);-1===o?(r.push(i),s.push([n])):s[o].push(n)}),a(new i(r).zipWithArray(s,function(e,t){var n=new i(t);return n.key=e,n}))})},"evaluated":function(){return new i(this.toArray())},"except":function(e){return this.filter(function(t){return t!==e})},"sortBy":function(e){var t=this;return e=u(e),new i(function(n){var o=t.toArray(),a=f(0,o.length).toArray(),r=i(o).map(e).toArray();a.sort(function(e,t){var n=r[e],i=r[t];if(typeof n==typeof i){if(n===i)return t>e?-1:1;if(i>n)return-1;if(n>i)return 1}throw new TypeError("cannot compare "+n+" and "+i)}),new i(a).forEach(function(e){n(o[e])})})},"count":function(){var e=0;return this.forEach(function(){e++}),e}};var d=function(e,t){var n=e;return"undefined"==typeof t&&(t=1),new i(function(e){for(;;)e(n),n+=t})},f=function(e,t){return d(e,1).take(t)},h=e.Generator;e.Generator=i,i.BreakIteration=n,i.Count=d,i.Range=f,i.IterationError=r,i.noConflict=function(){return e.Generator=h,i}}(this);var moderatorTools=function(e){var t={},n=function(){$(document).on("click",".quick-unmod",function(){var e,t,n=$(this).closest("tr");n.length?(e=n.attr("id").replace("fl-",""),n.prev().hasClass("monologue-row")&&(0==n.next().length||n.next().hasClass("monologue-row"))&&(t=n.prev())):(n=$(this).closest("li"),e=n.data("flag_id"),1==n.closest("ul").find("li").length&&(t=n.closest(".flagged-message")));var i="",o="";n.find("input[name=noise]").prop("checked")&&(i="?noise=true",o=" and notify the flagger that moderator flags should only be used for serious issues"),confirm("Dismiss this flag"+o+"?")&&$.post("/flags/"+e+"/clear"+i,fkey(),function(){n.remove(),t&&t.remove()})})};return t.initFlagSupport=function(t,i,o){$(document).on("click",".reflag,.counterflag,.mehflag",function(n){n.preventDefault();var i,o,a=$(this),r=a.closest("tr");r.length?(o=r.prev("tr").attr("id").replace("msg-",""),i=a.closest("td")):(r=a.closest(".flagged-message"),o=r.data("message_id"),i=a.parent());var s=a.hasClass("reflag")?"flag":a.hasClass("counterflag")?"counter-flag":"meh-flag";if(!t||"meh-flag"==s||confirm("Please note that since you're a moderator, your vote is binding. Continue?")){var c=$("<img/>").attr("src",IMAGE("progress-dots.gif")).appendTo(i),l=function(t){if("ok"==t)r.fadeOut(function(){$(this).remove()});else{var n=t||GENERIC_ERROR;e&&n&&e(n),c.remove()}},u=function(t){c.remove(),e&&e(t)};messageActionById(o,s,null,l,u)}}),BindFlagListPopup("#flag-count, .global-flags:not(.mod-flag)","/admin/flagged?json=true&show=new","/admin/flagged?show=all",e,o),BindFlagListPopup("#modflag-count, .global-flags.mod-flag","/admin/flagged-moderator?json=true","/admin/flagged-moderator",e),t&&n()},t};$.fn.fadeOutAndRemove=function(){return this.each(function(){var e=$(this);e.fadeOut("fast",function(){e.trigger("removing").remove()})})},GENERIC_ERROR="An error occurred performing this action",$(function(){function e(e,n,i){return t.is(":empty")?(t.html(e),t.append($("<p><button class='dismiss-input-hint button'/></p>").find("button").text(n||"Ok").data("set-pref",i||-1).end()),void 0):(queue.push(Array.prototype.slice.call(arguments)),void 0)
}CHAT.inputHint={"show":e};var t=$(".input-hint");queue=[],"absolute"!=t.css("position")&&t.remove(),t.on("click",".dismiss-input-hint",function(){var n=parseInt($(this).data("set-pref"),10);t.empty(),queue.length&&e.apply(null,queue.shift()),n>0&&$.post("/users/set-pref/"+n,fkey())})}),$(function(){var e=function(e){$.post("/mobile/"+e).done(function(){window.location.reload(!0)})};window.CHAT.switchMobile=e,$(".mobile-on").click(function(){return e("on"),!1}),$(".mobile-off").click(function(){return e("off"),!1})}),function(e){e.fn.extend({"autocomplete":function(t,n){var i="string"==typeof t;return n=e.extend({},e.Autocompleter.defaults,{"url":i?t:null,"data":i?null:t,"delay":i?e.Autocompleter.defaults.delay:10,"max":n&&!n.scroll?10:150,"noRecord":"No Records."},n),n.highlight=n.highlight||function(e){return e},n.formatMatch=n.formatMatch||n.formatItem,this.each(function(){new e.Autocompleter(this,n)})},"result":function(e){return this.bind("result",e)},"search":function(e){return this.trigger("search",[e])},"flushCache":function(){return this.trigger("flushCache")},"setOptions":function(e){return this.trigger("setOptions",[e])},"unautocomplete":function(){return this.trigger("unautocomplete")}}),e.Autocompleter=function(t,n){function i(){var i=T.selected();if(!i)return!1;var o=i.result;if(w=o,n.multiple){var r=a(y.val());if(r.length>1){var s,c=n.multipleSeparator.length,u=e(t).selection().start,d=0;e.each(r,function(e,t){return d+=t.length,d>=u?(s=e,!1):(d+=c,void 0)}),r[s]=o,o=r.join(n.multipleSeparator)}o+=n.multipleSeparator}return y.val(o),l(),y.trigger("result",[i.data,i.value]),!0}function o(e,t){if(v==p.DEL)return T.hide(),void 0;var i=y.val();(t||i!=w)&&(w=i,i=r(i),i.length>=n.minChars?(y.addClass(n.loadingClass),n.matchCase||(i=i.toLowerCase()),d(i,u,l)):(h(),T.hide()))}function a(t){return t?n.multiple?e.map(t.split(n.multipleSeparator),function(n){return e.trim(t).length?e.trim(n):null}):[e.trim(t)]:[""]}function r(i){if(!n.multiple)return i;var o=a(i);if(1==o.length)return o[0];var r=e(t).selection().start;return o=r==i.length?a(i):a(i.replace(i.substring(r),"")),o[o.length-1]}function s(i,o){n.autoFill&&r(y.val()).toLowerCase()==i.toLowerCase()&&v!=p.BACKSPACE&&(y.val(y.val()+o.substring(r(w).length)),e(t).selection(w.length,w.length+o.length))}function c(){clearTimeout(g),g=setTimeout(l,200)}function l(){T.visible();T.hide(),clearTimeout(g),h(),n.mustMatch&&y.search(function(e){if(!e)if(n.multiple){var t=a(y.val()).slice(0,-1);y.val(t.join(n.multipleSeparator)+(t.length?n.multipleSeparator:""))}else y.val(""),y.trigger("result",null)})}function u(e,t){t&&t.length&&C?(h(),T.display(t,e),s(e,t[0].value),T.show()):l()}function d(i,o,a){n.matchCase||(i=i.toLowerCase());var s=b.load(i);if(s)if(s.length)o(i,s);else{var c=n.parse&&n.parse(n.noRecord)||f(n.noRecord);o(i,c)}else if("string"==typeof n.url&&n.url.length>0){var l={"timestamp":+new Date};e.each(n.extraParams,function(e,t){l[e]="function"==typeof t?t():t}),e.ajax({"mode":"abort","port":"autocomplete"+t.name,"dataType":n.dataType,"url":n.url,"data":e.extend({"q":r(i),"limit":n.max},l),"success":function(e){var t=n.parse&&n.parse(e)||f(e);b.add(i,t),o(i,t)}})}else T.emptyList(),null!=m?m():a(i)}function f(t){for(var i=[],o=t.split("\n"),a=0;a<o.length;a++){var r=e.trim(o[a]);r&&(r=r.split("|"),i[i.length]={"data":r,"value":r[0],"result":n.formatResult&&n.formatResult(r,r[0])||r[0]})}return i}function h(){y.removeClass(n.loadingClass)}var p={"UP":38,"DOWN":40,"DEL":46,"TAB":9,"RETURN":13,"ESC":27,"COMMA":188,"PAGEUP":33,"PAGEDOWN":34,"BACKSPACE":8},m=null;null!=n.failure&&"function"==typeof n.failure&&(m=n.failure);var g,v,$,y=e(t).attr("autocomplete","off").addClass(n.inputClass),w="",b=e.Autocompleter.Cache(n),C=0,x={"mouseDownOnSelect":!1},T=e.Autocompleter.Select(n,t,i,x);-1!=navigator.userAgent.indexOf("Opera")&&e(t.form).bind("submit.autocomplete",function(){return $?($=!1,!1):void 0}),y.bind((-1!=navigator.userAgent.indexOf("Opera")&&!1 in window?"keypress":"keydown")+".autocomplete",function(t){switch(C=1,v=t.keyCode,t.keyCode){case p.UP:T.visible()?(t.preventDefault(),T.prev()):o(0,!0);break;case p.DOWN:T.visible()?(t.preventDefault(),T.next()):o(0,!0);break;case p.PAGEUP:T.visible()?(t.preventDefault(),T.pageUp()):o(0,!0);break;case p.PAGEDOWN:T.visible()?(t.preventDefault(),T.pageDown()):o(0,!0);break;case n.multiple&&","==e.trim(n.multipleSeparator)&&p.COMMA:case p.TAB:case p.RETURN:if(i())return t.preventDefault(),$=!0,!1;break;case p.ESC:T.hide();break;default:clearTimeout(g),g=setTimeout(o,n.delay)}}).focus(function(){C++}).blur(function(){C=0,x.mouseDownOnSelect||c()}).click(function(){n.clickFire?T.visible()||o(0,!0):C++>1&&!T.visible()&&o(0,!0)}).bind("search",function(){function t(e,t){var i;if(t&&t.length)for(var o=0;o<t.length;o++)if(t[o].result.toLowerCase()==e.toLowerCase()){i=t[o];break}"function"==typeof n?n(i):y.trigger("result",i&&[i.data,i.value])}var n=arguments.length>1?arguments[1]:null;e.each(a(y.val()),function(e,n){d(n,t,t)})}).bind("flushCache",function(){b.flush()}).bind("setOptions",function(){e.extend(!0,n,arguments[1]),"data"in arguments[1]&&b.populate()}).bind("unautocomplete",function(){T.unbind(),y.unbind(),e(t.form).unbind(".autocomplete")})},e.Autocompleter.defaults={"inputClass":"ac_input","resultsClass":"ac_results","loadingClass":"ac_loading","minChars":1,"delay":400,"matchCase":!1,"matchSubset":!0,"matchContains":!1,"cacheLength":100,"max":1e3,"mustMatch":!1,"extraParams":{},"selectFirst":!0,"formatItem":function(e){return e[0]},"formatMatch":null,"autoFill":!1,"width":0,"multiple":!1,"multipleSeparator":" ","inputFocus":!0,"clickFire":!1,"highlight":function(e,t){return e.replace(new RegExp("(?![^&;]+;)(?!<[^<>]*)("+t.replace(/([\^\$\(\)\[\]\{\}\*\.\+\?\|\\])/gi,"\\$1")+")(?![^<>]*>)(?![^&;]+;)","gi"),"<strong>$1</strong>")},"scroll":!0,"scrollHeight":180,"scrollJumpPosition":!0},e.Autocompleter.Cache=function(t){function n(e,n){t.matchCase||(e=e.toLowerCase());var i=e.indexOf(n);return"word"==t.matchContains&&(i=e.toLowerCase().search("\\b"+n.toLowerCase())),-1==i?!1:0==i||t.matchContains}function i(e,n){s>t.cacheLength&&a(),r[e]||s++,r[e]=n}function o(){if(!t.data)return!1;var n={},o=0;t.url||(t.cacheLength=1),n[""]=[];for(var a=0,r=t.data.length;r>a;a++){var s=t.data[a];s="string"==typeof s?[s]:s;var c=t.formatMatch(s,a+1,t.data.length);if("undefined"!=typeof c&&c!==!1){var l=c.charAt(0).toLowerCase();n[l]||(n[l]=[]);var u={"value":c,"data":s,"result":t.formatResult&&t.formatResult(s)||c};n[l].push(u),o++<t.max&&n[""].push(u)}}e.each(n,function(e,n){t.cacheLength++,i(e,n)})}function a(){r={},s=0}var r={},s=0;return setTimeout(o,25),{"flush":a,"add":i,"populate":o,"load":function(i){if(!t.cacheLength||!s)return null;if(!t.url&&t.matchContains){var o=[];for(var a in r)if(a.length>0){var c=r[a];e.each(c,function(e,t){n(t.value,i)&&o.push(t)})}return o}if(r[i])return r[i];if(t.matchSubset)for(var l=i.length-1;l>=t.minChars;l--){var c=r[i.substr(0,l)];if(c){var o=[];return e.each(c,function(e,t){n(t.value,i)&&(o[o.length]=t)}),o}}return null}}},e.Autocompleter.Select=function(t,n,i,o){function a(){$&&(h=e("<div/>").hide().addClass(t.resultsClass).css("position","absolute").appendTo(document.body).hover(function(){e(this).is(":visible")&&n.focus(),o.mouseDownOnSelect=!1}),p=e("<ul/>").appendTo(h).mouseover(function(t){r(t).nodeName&&"LI"==r(t).nodeName.toUpperCase()&&(g=e("li",p).removeClass(m.ACTIVE).index(r(t)),e(r(t)).addClass(m.ACTIVE))}).click(function(o){return e(r(o)).addClass(m.ACTIVE),i(),t.inputFocus&&n.focus(),!1}).mousedown(function(){o.mouseDownOnSelect=!0}).mouseup(function(){o.mouseDownOnSelect=!1}),t.width>0&&h.css("width",t.width),$=!1)}function r(e){for(var t=e.target;t&&"LI"!=t.tagName;)t=t.parentNode;return t?t:[]}function s(e){d.slice(g,g+1).removeClass(m.ACTIVE),c(e);var n=d.slice(g,g+1).addClass(m.ACTIVE);if(t.scroll){var i=0;d.slice(0,g).each(function(){i+=this.offsetHeight}),i+n[0].offsetHeight-p.scrollTop()>p[0].clientHeight?p.scrollTop(i+n[0].offsetHeight-p.innerHeight()):i<p.scrollTop()&&p.scrollTop(i)}}function c(e){(t.scrollJumpPosition||!t.scrollJumpPosition&&!(0>e&&0==g||e>0&&g==d.size()-1))&&(g+=e,0>g?g=d.size()-1:g>=d.size()&&(g=0))}function l(e){return t.max&&t.max<e?t.max:e}function u(){p.empty();for(var n=l(f.length),i=0;n>i;i++)if(f[i]){var o=t.formatItem(f[i].data,i+1,n,f[i].value,v);if(o!==!1){var a=e("<li/>").html(t.highlight(o,v)).addClass(i%2==0?"ac_even":"ac_odd").appendTo(p)[0];e.data(a,"ac_data",f[i])}}d=p.find("li"),t.selectFirst&&(d.slice(0,1).addClass(m.ACTIVE),g=0),e.fn.bgiframe&&p.bgiframe()}var d,f,h,p,m={"ACTIVE":"ac_over"},g=-1,v="",$=!0;return{"display":function(e,t){a(),f=e,v=t,u()},"next":function(){s(1)},"prev":function(){s(-1)},"pageUp":function(){0!=g&&0>g-8?s(-g):s(-8)},"pageDown":function(){g!=d.size()-1&&g+8>d.size()?s(d.size()-1-g):s(8)},"hide":function(){h&&h.hide(),d&&d.removeClass(m.ACTIVE),g=-1},"visible":function(){return h&&h.is(":visible")},"current":function(){return this.visible()&&(d.filter("."+m.ACTIVE)[0]||t.selectFirst&&d[0])},"show":function(){var i=e(n).offset();if(h.css({"width":"string"==typeof t.width||t.width>0?t.width:e(n).width(),"top":i.top+n.offsetHeight,"left":i.left}).show(),t.scroll&&(p.scrollTop(0),p.css({"maxHeight":t.scrollHeight,"overflow":"auto"}),-1!=navigator.userAgent.indexOf("MSIE")&&"undefined"==typeof document.body.style.maxHeight)){var o=0;d.each(function(){o+=this.offsetHeight});var a=o>t.scrollHeight;p.css("height",a?t.scrollHeight:o),a||d.width(p.width()-parseInt(d.css("padding-left"))-parseInt(d.css("padding-right")))}},"selected":function(){var t=d&&d.filter("."+m.ACTIVE).removeClass(m.ACTIVE);return t&&t.length&&e.data(t[0],"ac_data")},"emptyList":function(){p&&p.empty()},"unbind":function(){h&&h.remove()}}},e.fn.selection=function(e,t){if(void 0!==e)return this.each(function(){if(this.createTextRange){var n=this.createTextRange();void 0===t||e==t?(n.move("character",e),n.select()):(n.collapse(!0),n.moveStart("character",e),n.moveEnd("character",t),n.select())}else this.setSelectionRange?this.setSelectionRange(e,t):this.selectionStart&&(this.selectionStart=e,this.selectionEnd=t)});var n=this[0];if(n.createTextRange){var i=document.selection.createRange(),o=n.value,a="<->",r=i.text.length;i.text=a;var s=n.value.indexOf(a);return n.value=o,this.selection(s,s+r),{"start":s,"end":s+r}}return void 0!==n.selectionStart?{"start":n.selectionStart,"end":n.selectionEnd}:void 0}}(jQuery),function(e){function t(t,n,i){t.value=e(n).text(),e(t).change(),t.focus(),i.hide()}function n(e,t){var n=e.getHours(),o=t.show24Hours?n:(n+11)%12+1,a=e.getMinutes();return i(o)+t.separator+i(a)+(t.show24Hours?"":12>n?" AM":" PM")}function i(e){return(10>e?"0":"")+e}function o(e,t){return"object"==typeof e?r(e):a(e,t)}function a(e,t){if(e){var n=e.split(t.separator),i=parseFloat(n[0]),o=parseFloat(n[1]);t.show24Hours||(12===i&&-1!==e.substr("AM")?i=0:12!==i&&-1!==e.indexOf("PM")&&(i+=12));var a=new Date(0,0,0,i,o,0);return r(a)}return null}function r(e){return e.setFullYear(2001),e.setMonth(0),e.setDate(0),e}e.fn.timePicker=function(t){var n=e.extend({},e.fn.timePicker.defaults,t);return this.each(function(){e.timePicker(this,n)})},e.timePicker=function(t,n){var i=e(t)[0];return i.timePicker||(i.timePicker=new jQuery._timePicker(i,n))},e._timePicker=function(i,s){var c=!1,l=!1,u=o(s.startTime,s),d=o(s.endTime,s);e(i).attr("autocomplete","OFF");for(var f=[],h=new Date(u);d>=h;)f[f.length]=n(h,s),h=new Date(h.setMinutes(h.getMinutes()+s.step));for(var p=e('<div class="time-picker'+(s.show24Hours?"":" time-picker-12hours")+'"></div>'),m=e("<ul></ul>"),g=0;g<f.length;g++)m.append("<li>"+f[g]+"</li>");p.append(m);var v=e(i).offset();p.appendTo("body").css({"top":v.top,"left":v.left}).hide(),p.mouseover(function(){c=!0}).mouseout(function(){c=!1}),e("li",m).mouseover(function(){l||(e("li.selected",p).removeClass("selected"),e(this).addClass("selected"))}).mousedown(function(){c=!0}).click(function(){t(i,this,p,s),c=!1});var $=function(){if(p.is(":visible"))return!1;e("li",p).removeClass("selected"),p.show();var t=i.value?a(i.value,s):u,o=60*u.getHours()+u.getMinutes(),c=60*t.getHours()+t.getMinutes()-o,l=Math.round(c/s.step),f=r(new Date(0,0,0,0,l*s.step+o,0));f=f>u&&d>=f?f:u;var h=e("li:contains("+n(f,s)+")",p);return h.length&&(h.addClass("selected"),p[0].scrollTop=h[0].offsetTop),!0};e(i).focus($).click($),e(i).blur(function(){c||p.hide()}),e(i).keydown(function(n){var o;l=!0;var a=p[0].scrollTop;switch(n.keyCode){case 38:if($())return!1;o=e("li.selected",m);var r=o.prev().addClass("selected")[0];return r?(o.removeClass("selected"),r.offsetTop<a&&(p[0].scrollTop=a-r.offsetHeight)):(o.removeClass("selected"),r=e("li:last",m).addClass("selected")[0],p[0].scrollTop=r.offsetTop-r.offsetHeight),!1;case 40:if($())return!1;o=e("li.selected",m);var c=o.next().addClass("selected")[0];return c?(o.removeClass("selected"),c.offsetTop+c.offsetHeight>a+p[0].offsetHeight&&(p[0].scrollTop=a+c.offsetHeight)):(o.removeClass("selected"),c=e("li:first",m).addClass("selected")[0],p[0].scrollTop=0),!1;case 13:if(p.is(":visible")){var u=e("li.selected",m)[0];t(i,u,p,s)}return!1;case 27:return p.hide(),!1}return!0}),e(i).keyup(function(){l=!1}),this.getTime=function(){return a(i.value,s)},this.setTime=function(t){i.value=n(r(t),s),e(i).change()}},e.fn.timePicker.defaults={"step":30,"startTime":new Date(0,0,0,0,0,0),"endTime":new Date(0,0,0,23,30,0),"separator":":","show24Hours":!0}}(jQuery),jQuery.fn.highlight=function(e){function t(e,n){var i=0;if(3==e.nodeType){var o=e.data.toUpperCase().indexOf(n);if(o>=0){var a=document.createElement("span");a.className="highlight";var r=e.splitText(o),s=(r.splitText(n.length),r.cloneNode(!0));a.appendChild(s),r.parentNode.replaceChild(a,r),i=1}}else if(1==e.nodeType&&e.childNodes&&!/(script|style)/i.test(e.tagName))for(var c=0;c<e.childNodes.length;++c)c+=t(e.childNodes[c],n);return i}return this.each(function(){t(this,e.toUpperCase())})},jQuery.fn.removeHighlight=function(){return this.find("span.highlight").each(function(){with(this.parentNode.firstChild.nodeName,this.parentNode)replaceChild(this.firstChild,this),normalize()}).end()},!function(e,t,n){"function"==typeof define?define(n):"undefined"!=typeof module?module.exports=n():t[e]=n(t)}("klass",this,function(e){function t(e){return a.call(n(e)?e:function(){},e,1)}function n(e){return typeof e===s}function i(e,t,n){return function(){var i=this.supr;this.supr=n[l][e];var o={}.fabricatedUndefined,a=o;try{a=t.apply(this,arguments)}finally{this.supr=i}return a}}function o(e,t,o){for(var a in t)t.hasOwnProperty(a)&&(e[a]=n(t[a])&&n(o[l][a])&&c.test(t[a])?i(a,t[a],o):t[a])}function a(e,t){function i(){}function r(){this.initialize?this.initialize.apply(this,arguments):(t||u&&s.apply(this,arguments),d.apply(this,arguments))}i[l]=this[l];var s=this,c=new i,u=n(e),d=u?e:this,f=u?{}:e;return r.methods=function(e){return o(c,e,s),r[l]=c,this},r.methods.call(r,f).prototype.constructor=r,r.extend=a,r[l].implement=r.statics=function(e,t){return e="string"==typeof e?function(){var n={};return n[e]=t,n}():e,o(this,e,s),this},r}e=e||this;var r=e.klass,s="function",c=/.*/,l="prototype";return t.noConflict=function(){return e.klass=r,this},t}),window.StackExchange={},StackExchange.init=function(){return function(e){StackExchange.options=e,e.serverTimeOffsetSec=e.serverTime-(new Date).getTime()/1e3}}(),StackExchange.helpers=function(){var e={"addSpinner":function(t,n){$(t).append(e.getSpinnerImg(n))},"getSpinnerImg":function(e){var t=$('<img class="ajax-loader" src="/content/img/progress-dots.gif" title="loading..." alt="loading..." />');return e&&t.css(e),t},"removeSpinner":function(){$("img.ajax-loader").remove()},"showErrorPopup":function(e,t,n){$(".error-notification").remove();var i=$('<div class="error-notification supernovabg"><h2>'+t+"</h2>"+(n?"":'<span class="error-close">(click on this box to dismiss)</span>')+"</div>"),o=function(){i.fadeOutAndRemove()};$(e).append(i),i.click(o).fadeIn("fast"),setTimeout(o,n?Math.max(2500,40*t.length):3e4)},"removeErrorPopup":function(){$(".error-notification").fadeOutAndRemove()}};return e}(),StackExchange.topbar=function(){function e(e){StackExchange.options.enableLogging&&console.log("topbar: "+e)}function t(e){for(var t=0;t<f.length;t++){var n=f[t].$button;if(n&&n[0]==e)return!0}return!1}function n(){for(var e=0;e<f.length;e++)f[e].toggle(!1)}function i(t){var n;if(t&&(n=JSON.parse(t))){e("realtime message - "+t);for(var i in n)for(var o=0;o<f.length;o++)if(i==f[o].name){f[o].handleRealtimeMessage(n[i]);break}}}var o=klass({"name":"","url":"","cssClass":"","button":null,"$dialog":null,"$loadingPlaceholder":null,"$preloadedDialog":null,"hasRead":!1}).statics({"$corral":$(".js-topbar-dialog-corral")}).methods({"isLoading":function(){return null!=this.$loadingPlaceholder},"isLoaded":function(){return null!=this.$dialog},"isVisible":function(){var e=this.$dialog||this.$loadingPlaceholder;return null!=e&&e.is(":visible")},"toggle":function(e,t){if("boolean"!=typeof e)throw new Error("showOrHide is a required parameter");if(!e){if(this.isLoading())return this.showOrHide(!1),void 0;if(!this.isLoaded())return}if(this.isLoaded()||this.isLoading()?(e||t||!this.hasRead||this.markAsRead(),this.showOrHide(e)):this.$preloadedDialog?this.loadChildContent():this.loadDialog(),e)for(var n=0;n<f.length;n++)this.button!=f[n]&&f[n].toggle(!1,t)},"showOrHide":function(e){var t=this.$dialog||this.$loadingPlaceholder;t&&t.toggle(e),e&&this.$dialog&&(this.hasRead=!0)},"loadChildContent":function(){var e=this.$preloadedDialog.find(".child-content");if(this.$dialog=this.$preloadedDialog,this.positionDialogUnderButton(),this.showOrHide(!0),this.url){$("<div>",{"class":"child-content-loading"}).append(StackExchange.helpers.getSpinnerImg()).appendTo(e);var t=this;this.fetchUrl().done(function(n){e.html(n),t.afterLoad()})}},"loadDialog":function(){if(!this.isLoading()){this.$loadingPlaceholder=this.getLoadingPlaceholder().appendTo(o.$corral),this.positionDialogUnderButton(),this.showOrHide(!0);var e=this;this.fetchUrl().done(function(t){if(t.length){e.$dialog=$(t).appendTo(o.$corral),e.afterLoad();var n=e.$loadingPlaceholder.is(":visible");e.positionDialogUnderButton(),e.showOrHide(n)}else StackExchange.helpers.showErrorPopup(e.button.$button.parent(),"An error occurred while loading - please try again.")}).fail(function(e,t,n){console.log(n)}).always(function(){e.$loadingPlaceholder.remove(),e.$loadingPlaceholder=null})}},"afterLoad":function(){},"getLoadingPlaceholder":function(){var e=$("<div/>").append(StackExchange.helpers.getSpinnerImg()).html(),t=['<div class="topbar-dialog ',this.cssClass,' dno">','<div class="header">',e,"</div>",'<div class="modal-content"/>',"</div>"];return $(t.join(""))},"positionDialogUnderButton":function(){var e=this.button.$button.outerHeight(),t=this.button.$button.offset().left-f[0].$button.offset().left;(this.$dialog||this.$loadingPlaceholder).css({"top":e,"left":t})},"fetchUrl":function(){e("fetching "+this.url);var t=$.ajax({"type":"GET","url":this.url,"dataType":"html"});return t},"markAsRead":function(){this.button.markAsRead(),this.isLoaded()&&this.$dialog.find(".unread-item").removeClass("unread-item")},"handleRealtimeMessage":function(){this.clearLoadedDialog()},"clearLoadedDialog":function(){this.isLoaded()&&(this.$dialog.remove(),this.$dialog=null,this.hasRead=!1)}}),a=klass({"name":"","selector":"","dialog":null,"$button":null,"onClass":"","unreadCountPrefix":"","queuedUnreadCount":0,"showsOnMouseOver":!1}).methods({"initialize":function(){this.dialog.name=name,this.dialog.button=this,h.push(this.dialog);var e=this;this.$button=$(this.selector),this.$button.click(function(){return e.toggle(),!1}),this.showsOnMouseOver&&this.$button.mouseover(function(){e.showOnMouseOver()}),this.onClass="topbar-icon-on"+(this.onClass?" ":"")+this.onClass},"toggle":function(e,t){e="boolean"==typeof e?e:!this.$button.hasClass(this.onClass),this.$button.toggleClass(this.onClass,e),this.dialog.toggle(e,t)},"showOnMouseOver":function(){for(var e=!1,t=0;t<f.length;t++){var n=f[t];if(n!=this&&n.showsOnMouseOver&&n.isOn()){e=!0;break}}e&&this.toggle(!0,!0)},"isOn":function(){return this.$button.hasClass(this.onClass)},"markAsRead":function(){this.$button.find(".unread-count").fadeOut();var e=this.$button.data("unread-class");e&&this.$button.removeClass(e),this.dequeuePendingUnreadCount()},"dequeuePendingUnreadCount":function(){this.queuedUnreadCount&&(this.setUnreadCount(this.queuedUnreadCount),this.queuedUnreadCount=0,this.dialog.clearLoadedDialog())},"setUnreadCount":function(e){if(void 0===e);else if(0>=e)this.queuedUnreadCount=0,this.isOn()||this.markAsRead();else if(e>0)if(this.isOn())this.queuedUnreadCount=e;else{var t=this.$button.find(".unread-count");t.text(this.unreadCountPrefix+e).fadeIn(),this.addUnreadClass(),this.dialog.clearLoadedDialog()}},"addUnreadClass":function(){var e=this.$button.data("unread-class");e&&this.$button.addClass(e)},"handleRealtimeMessage":function(){}}),r=o.extend({"url":"/topbar/site-switcher","cssClass":"siteSwitcher-dialog","$searchItems":null}).methods({"afterLoad":function(){this.$dialog.find("#js-site-filter-txt").typeWatch({"highlight":!1,"wait":250,"captureLength":-1,"callback":$.proxy(this.filterSites,this)}),this.$searchItems=this.$dialog.find(".js-other-sites li").clone().map(function(){return{"title":$(".site-icon",this).attr("title").toLowerCase(),"description":$(".site-desc",this).text().toLowerCase(),"hostname":$("a",this).first().attr("href"),"li":this}});var e=this.$dialog;this.$dialog.find("#js-site-filter-txt").focus(function(){var t=e.offset().top+e.height(),n=e.find(".other-sites li:nth-child(2)"),i=n.offset().top+n.height();i>t&&e.animate({"scrollTop":e.scrollTop()+i-t},750)}),this.supr()},"doSearch":function(e,t){var n;t=t.toLowerCase();var i=[];return $.each(e,function(e,n){var o={"index":e,"li":n.li,"item":n},a=n.title.indexOf(t);n.title==t?o.priority=1:0==a?o.priority=2:a>-1?o.priority=3:n.description.indexOf(t)>-1?o.priority=4:n.hostname.indexOf(t)>-1&&(o.priority=5),o.priority&&i.push(o)}),n=i.sort(function(e,t){return e.priority-t.priority||e.index-t.index})},"filterSites":function(e){var t=$(".js-other-sites"),n=this.$searchItems;t.empty(),""!=e&&(n=this.doSearch(n,e,!0)),t.append(n.map(function(e){return this&&this.li||e.li}))}}),s=a.extend({"name":"SiteSwitcher","selector":".js-site-switcher-button","dialog":new r,"showsOnMouseOver":!0,"onClass":"icon-site-switcher-on"}),c=o.extend({"url":"/topbar/inbox","cssClass":"inbox-dialog"}),l=a.extend({"name":"Inbox","selector":".js-inbox-button","dialog":new c,"showsOnMouseOver":!0}).methods({"handleRealtimeMessage":function(e){this.setUnreadCount(e.UnreadInboxCount)}}),u=o.extend({"url":"/topbar/achievements","cssClass":"achievements-dialog"}).methods({"afterLoad":function(){this.alignRep(),this.bindDateGroupToggles(),this.displayUtcTime(),this.supr()},"alignRep":function(){var e=this.$dialog.find(".js-items .js-faux-column"),t=0;e.filter(".js-rep-change").each(function(){var e=$.trim($(this).text()).length;e>t&&(t=e)}),t>0&&e.width(6*t)},"bindDateGroupToggles":function(){this.$dialog.find(".js-date-group-toggle").click(function(){var e=$(this),t=e.closest(".js-date-group"),n=t.find(".js-items"),i=t.find(".rep-site-container");e.find(".date-group-toggle").toggleClass("toggle-hidden"),n.add(i).fadeToggle("fast")}),this.$dialog.find(".rep-site-container").on("click",function(e){e.stopImmediatePropagation()})},"displayUtcTime":function(){var e=this.$dialog,t=function(){var t=new Date;t.setTime(t.getTime()+1e3*StackExchange.options.serverTimeOffsetSec);var n=t.getUTCHours(),i=t.getUTCMinutes();10>n&&(n="0"+n),10>i&&(i="0"+i),e.find(".js-utc-time").text(n+":"+i)};t(),setInterval(t,6e4)}}),d=a.extend({"name":"Achievements","selector":".js-achievements-button","dialog":new u,"unreadCountPrefix":"+","showsOnMouseOver":!0}).methods({"handleRealtimeMessage":function(e){var t=0===(e.UnreadRepCount||0)&&e.UnreadNonRepCount>0;t?this.addUnreadClass():this.setUnreadCount(e.UnreadRepCount)}}),f=[],h=[];return{"init":function(e){StackExchange.init(e),o.$corral.length||(o.$corral=$(".js-topbar-dialog-corral")),window.devicePixelRatio>=1.5&&$(".js-avatar-me").attr("src",function(e,t){return t.replace("?s=24","?s=48")});var i=new l,a=new d;f.push(new s),f.push(i),f.push(a),$(document).click(function(e){t(e.target)||$.contains(o.$corral[0],e.target)||n()}),$.get("/topbar/get-unread-counts",function(e){e&&(i.handleRealtimeMessage(e),a.handleRealtimeMessage(e))})},"hideAll":n,"handleRealtimeMessage":i}}();